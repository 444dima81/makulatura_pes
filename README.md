# Makulatura LM

Экспериментальный проект по обучению языковой модели для генерации поэтических текстов и песен в стиле группы **«Макулатура»** с сохранением структуры секций авторов

Проект не пытается «копировать тексты», а обучает модель воспроизводить **язык, интонацию и поэтику**

---

## Базовая модель

- **Qwen2.5-7B-Instruct**
- Формат обучения: **qLoRA (4-bit, NF4)**
- Обучение проводилось в **Google Colab (Free / T4)**
- Генерация и дальнейшая работа возможны локально

---

## Источник данных

### 1. Парсинг текстов
Тексты песен собирались из открытых источников и приводились к единому формату

Используемые скрипты:
- `parser/crawl_lyrics.py` — сбор текстов
- `parser/get_index.py` — индексация песен

Результат:
- `data/songs.jsonl`
- `data/songs_index.jsonl`

---

### 2. Очистка и нормализация

Перед обучением тексты были очищены:
- удалены HTML, мусорные символы, лишние повторы
- нормализованы переносы строк
- приведены кавычки, тире, пробелы
- сохранена авторская пунктуация

Скрипты:
- `preprocessed/normalize_songs.py`
- `preprocessed/make_canonical_text.py`

Результат:
- `data/canonical_corpus.txt`
- `data/canonical_corpus.jsonl`

---

## Разметка и структура

Тексты были размечены в **каноническом формате секций**:

```xml
<VERSE speaker=speransky>
...
</VERSE>

<CHORUS speaker=alekhin>
...
</CHORUS>
```
Поддерживаемые теги:
	•	VERSE
	•	CHORUS
	•	INTRO
	•	OUTRO
	•	BRIDGE
	•	REFRAIN
	•	HOOK
  
---

## Конфигурация обучения

### LoRA
- `r`: 16  
- `alpha`: 32  
- `dropout`: 0.05  

### Параметры обучения
- **Optimizer**: `paged_adamw_8bit`  
- **Learning rate**: `1e-4`  
- **Epochs**: `4`  
- **Max sequence length**: `1200`  
- **Packing**: `true`  

Для обучения использовался `trl.SFTTrainer`.

---

## Результат обучения

После обучения модель начала уверенно:

- держать стиль
- писать связные образы
- соблюдать поэтическую интонацию и стиль
  
---

## Структура проекта
```
data/                  # данные и датасеты
parser/                # парсинг текстов
preprocessed/          # очистка и нормализация
adapters/              # LoRA-адаптеры и конфиги
generate_sections.py   # генерация секций песен
lora_qwen.ipynb        # обучение в Colab
post_filter.py         # постобработка генерации
```
